<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ì¤‘êµ­ ìˆ˜ì… ì˜ˆìƒ ê²¬ì  (ê³ ê°ìš©)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<!-- PWA ì—°ê²° -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1e3a8a">

<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js");
  });
}
</script>

<style>
/* ---------- ê¸€ë¡œë²Œ ---------- */
body {
  font-family: 'Inter','Pretendard',Arial,sans-serif;
  background:#f5f7fa;
  margin:0;
  padding-bottom:90px;
  color:#333;
}

/* ---------- í—¤ë” ---------- */
.header {
  background: linear-gradient(150deg,#1e3a8a,#3b82f6);
  color:white;
  padding:32px 20px 40px;
  text-align:center;
  border-bottom-left-radius:30px;
  border-bottom-right-radius:30px;
  box-shadow:0 4px 15px rgba(0,0,0,0.1);
}
.header h1 { margin:0; font-size:26px; font-weight:800; }

/* ---------- ì»¨í…Œì´ë„ˆ ---------- */
.wrapper {
  max-width:900px;
  margin:0 auto;
  padding:20px;
}

/* ---------- ì¹´ë“œ ---------- */
.card {
  background:#fff;
  padding:22px;
  border-radius:14px;
  box-shadow:0 6px 20px rgba(0,0,0,0.06);
  margin-bottom:20px;
  border:1px solid #edf1f5;
}

/* ---------- í¼ ì…ë ¥ ---------- */
.form-item {
  display:flex;
  flex-direction:column;
  margin-bottom:16px;
}
label {
  font-size:14px;
  font-weight:700;
  margin-bottom:6px;
}
input, select {
  padding:12px;
  border-radius:10px;
  border:1px solid #d1d5db;
  background:#f9fafb;
  font-size:16px;
}
input:focus, select:focus {
  border-color:#3b82f6;
  background:#fff;
  outline:none;
  box-shadow:0 0 0 3px rgba(59,130,246,0.2);
}

/* ---------- í•˜ì´ë¼ì´íŠ¸ ---------- */
.highlight {
  padding:12px;
  background:#eef2ff;
  border-radius:10px;
  text-align:right;
  font-weight:800;
  border:1px solid #c7d2fe;
  font-size:17px;
}

/* ---------- ì œí’ˆ ì¹´ë“œ ---------- */
.product-card {
  position:relative;
  background:#fff;
  padding:20px;
  border-radius:16px;
  border:1px solid #e5e7eb;
  box-shadow:0 4px 15px rgba(0,0,0,0.05);
  margin-bottom:20px;
}
.product-card h3 {
  margin:0 0 14px;
  font-size:17px;
  font-weight:800;
  color:#1e3a8a;
}

.remove-btn {
  position:absolute;
  top:15px;
  right:15px;
  background:#ef4444;
  color:white;
  border:none;
  padding:6px 12px;
  border-radius:8px;
  cursor:pointer;
  font-size:13px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.btn {
  padding:14px 28px;
  background:linear-gradient(135deg,#2563eb,#3b82f6);
  color:white;
  border:none;
  border-radius:30px;
  cursor:pointer;
  font-size:16px;
  font-weight:700;
  box-shadow:0 5px 14px rgba(59,130,246,0.3);
}

.result-big {
  font-size:26px;
  font-weight:900;
  color:#1d4ed8;
  text-align:right;
  padding:16px;
  border-radius:12px;
  background:#eef2ff;
  border:1px solid #c7d2fe;
}

.floating-bar {
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#ffffff;
  padding:14px 20px;
  box-shadow:0 -4px 12px rgba(0,0,0,0.12);
  border-top:1px solid #e5e7eb;
  display:flex;
  justify-content:space-between;
  align-items:center;
  z-index:9999;
}
.floating-price {
  font-size:20px;
  font-weight:900;
  color:#1d4ed8;
}
.floating-btn {
  padding:10px 16px;
  font-size:14px;
  border:none;
  border-radius:8px;
  background:#3b82f6;
  color:white;
}

/* ---------- ì¹´ì¹´ì˜¤í†¡ ë²„íŠ¼ ---------- */
.kakao-btn {
  width:100%;
  padding:18px;
  border:none;
  border-radius:12px;
  background:#FEE500;
  color:#000;
  font-size:18px;
  font-weight:800;
  box-shadow:0 4px 10px rgba(0,0,0,0.12);
  margin:30px 0 60px;
  cursor:pointer;
}
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <h1>ì¤‘êµ­ ìˆ˜ì… ì˜ˆìƒ ê²¬ì </h1>
ğŸ“ ê²½ê¸°ë„ í™”ì„±ì‹œ ë‚¨ì–‘ì ì‹ ë‚¨ì•ˆê¸¸ 279-7<br>
â˜ï¸ 010-9239-0071<br>
viva-lavida@naver.com

</div>

<div class="wrapper">

<!-- í™˜ìœ¨ ì…ë ¥ -->
<div class="card">
  <h3>í™˜ìœ¨ ì…ë ¥</h3>
  <div class="form-item">
    <label>1 RMB â†’ KRW í™˜ìœ¨</label>
    <input type="number" id="exchangeRate" placeholder="ì˜ˆ: 190~220">
  </div>
</div>

<div class="card">
  <p style="color:#555; font-size:15px;">
    ì•„ë˜ ì •ë³´ë¥¼ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ ì˜ˆìƒ ê¸ˆì•¡ì´ ê³„ì‚°ë©ë‹ˆë‹¤.<br>
    ì‹¤ì œ ê²¬ì ì€ ë‹´ë‹¹ì í™•ì¸ í›„ ì•ˆë‚´ë©ë‹ˆë‹¤.
  </p>
</div>

<!-- ì œí’ˆ ëª©ë¡ -->
<div id="productContainer"></div>

<div style="text-align:center;margin-bottom:20px;">
  <button id="addProductBtn" class="btn">â• ì œí’ˆ ì¶”ê°€</button>
</div>

<!-- ì „ì²´ ê²°ê³¼ -->
<div class="card">
  <h3 style="color:#1e3a8a;">ì „ì²´ ê²°ê³¼</h3>

  <div class="form-item">
    <label>ì „ì²´ ë°•ìŠ¤ ìˆ˜ëŸ‰</label>
    <div id="totalBoxes" class="highlight">0</div>
  </div>

  <div class="form-item">
    <label>ì „ì²´ CBM</label>
    <div id="totalCBM" class="highlight">0.0000</div>
  </div>

  <div class="form-item">
    <label>ì˜ˆìƒ ì´ ê¸ˆì•¡(ë¶€ê°€ì„¸ í¬í•¨)</label>
    <div id="finalTotal" class="result-big">0 ì›</div>
  </div>
</div>

<!-- ğŸ“© ì¹´ì¹´ì˜¤í†¡ ê²¬ì  ë³´ë‚´ê¸° ë²„íŠ¼ (í˜ì´ì§€ ê°€ì¥ í•˜ë‹¨ ì¶”ê°€) -->
<button class="kakao-btn" onclick="sendKakao()">ğŸ“© ì¹´ì¹´ì˜¤í†¡ìœ¼ë¡œ ê²¬ì  ë³´ë‚´ê¸°</button>

</div> <!-- wrapper ì¢…ë£Œ -->


<!-- í”Œë¡œíŒ… í•©ê³„ ë°” -->
<div class="floating-bar">
  <div class="floating-price" id="floatPrice">0 ì›</div>
  <button class="floating-btn" onclick="scrollToTop()">ë§¨ ìœ„ë¡œ</button>
</div>



<!-- ì œí’ˆ í…œí”Œë¦¿ -->
<template id="productTemplate">
  <div class="product-card">
    <button class="remove-btn">ì‚­ì œ</button>

    <h3>ì œí’ˆ ì •ë³´</h3>

    <div class="form-item">
      <label>ì œí’ˆëª…</label>
      <input type="text" class="p-name">
    </div>

    <div class="form-item">
      <label>ë‹¨ê°€ (RMB)</label>
      <input type="number" class="p-price">
    </div>

    <div class="form-item">
      <label>ìˆ˜ëŸ‰</label>
      <input type="number" class="p-qty">
    </div>

    <div class="form-item">
      <label>ì¤‘êµ­ íƒë°°ë¹„ ì´ì•¡ (RMB)</label>
      <input type="number" class="p-delivery">
    </div>

    <div class="form-item">
      <label>ê°œë‹¹ íƒë°°ë¹„</label>
      <div class="highlight p-delivery-unit">0 RMB</div>
    </div>

    <div class="form-item">
      <label>ì¸ê±´ë¹„ (RMB)</label>
      <input type="number" class="p-labor">
    </div>

    <div class="form-item">
      <label>ê´€ì„¸ìœ¨ (%)</label>
      <input type="number" class="p-duty" placeholder="ì˜ˆ: 13">
    </div>

    <div class="form-item">
      <label>ë°•ìŠ¤ í¬ê¸°</label>
      <select class="p-box">
        <option value="">ì„ íƒ</option>
        <option value="large">ëŒ€ (64Ã—43Ã—48 / 13Â¥)</option>
        <option value="medium">ì¤‘ (53Ã—35Ã—43 / 11Â¥)</option>
        <option value="small">ì†Œ (45Ã—35Ã—37 / 9Â¥)</option>
      </select>
    </div>

    <div class="form-item">
      <label>ë°•ìŠ¤ ìˆ˜ëŸ‰</label>
      <input type="number" class="p-boxcount">
    </div>

    <div class="form-item">
      <label>CBM</label>
      <div class="highlight p-cbm">0.0000</div>
    </div>

  </div>
</template>




<script>
/* ê´€ë¦¬ì ê³ ì •ê°’ */
const co2 = 200 * 220;
const customsFee = 33000;
const blFee = 22000;
const logistics = 110000;

const container = document.getElementById("productContainer");
const template = document.getElementById("productTemplate");


/* ---------- í™˜ìœ¨ ë¶ˆëŸ¬ì˜¤ê¸° ---------- */
function getRate() {
  const v = parseFloat(document.getElementById("exchangeRate").value);
  return v > 0 ? v : 200;
}


/* ---------- ë°ì´í„° ì €ì¥ ---------- */
function saveData() {
  const arr = {
    rate: document.getElementById("exchangeRate").value,
    products: []
  };

  document.querySelectorAll(".product-card").forEach(card => {
    arr.products.push({
      name: card.querySelector(".p-name").value,
      price: card.querySelector(".p-price").value,
      qty: card.querySelector(".p-qty").value,
      delivery: card.querySelector(".p-delivery").value,
      labor: card.querySelector(".p-labor").value,
      duty: card.querySelector(".p-duty").value,
      boxType: card.querySelector(".p-box").value,
      boxCount: card.querySelector(".p-boxcount").value
    });
  });

  localStorage.setItem("importEstimatorData", JSON.stringify(arr));
}


/* ---------- ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ---------- */
function loadData() {
  const saved = localStorage.getItem("importEstimatorData");
  if (!saved) return;

  const data = JSON.parse(saved);

  document.getElementById("exchangeRate").value = data.rate || "";

  document.querySelectorAll(".product-card").forEach(x => x.remove());

  data.products.forEach(item => {
    const node = template.content.cloneNode(true);
    container.appendChild(node);
    const card = container.lastElementChild;

    card.querySelector(".p-name").value = item.name;
    card.querySelector(".p-price").value = item.price;
    card.querySelector(".p-qty").value = item.qty;
    card.querySelector(".p-delivery").value = item.delivery;
    card.querySelector(".p-labor").value = item.labor;
    card.querySelector(".p-duty").value = item.duty;
    card.querySelector(".p-box").value = item.boxType;
    card.querySelector(".p-boxcount").value = item.boxCount;
  });
}


/* ---------- ì œí’ˆ ì¶”ê°€ ---------- */
function addProduct() {
  const node = template.content.cloneNode(true);
  container.appendChild(node);
  calc();
  saveData();
}


/* ---------- ê³„ì‚° ---------- */
function calc() {
  const rate = getRate();

  let totalCBM = 0;
  let totalBoxes = 0;
  let finalTotal = 0;

  document.querySelectorAll(".product-card").forEach(card => {
    const price = parseFloat(card.querySelector(".p-price").value) || 0;
    const qty = parseFloat(card.querySelector(".p-qty").value) || 0;
    const del = parseFloat(card.querySelector(".p-delivery").value) || 0;
    const labor = parseFloat(card.querySelector(".p-labor").value) || 0;
    const dutyRate = parseFloat(card.querySelector(".p-duty").value) || 0;

    const boxType = card.querySelector(".p-box").value;
    const boxCount = parseFloat(card.querySelector(".p-boxcount").value) || 0;

    const delUnit = qty > 0 ? del / qty : 0;
    card.querySelector(".p-delivery-unit").textContent = delUnit.toFixed(2)+" RMB";

    const boxPrice = { large:13, medium:11, small:9 }[boxType] || 0;
    const boxPerUnit = qty > 0 ? (boxPrice * boxCount) / qty : 0;

    const preset = {
      large:{l:64,w:43,h:48},
      medium:{l:53,w:35,h:43},
      small:{l:45,w:35,h:37}
    }[boxType];

    let cbm = preset ? (preset.l*preset.w*preset.h)/1_000_000*boxCount : 0;
    card.querySelector(".p-cbm").textContent = cbm.toFixed(4);

    totalCBM += cbm;
    totalBoxes += boxCount;

    const rmbTotal = (price + labor + delUnit + boxPerUnit) * qty;
    const krwBase = rmbTotal * rate;
    const duty = krwBase * (dutyRate / 100);

    const logisticsShare = totalCBM ? (cbm/totalCBM)*(totalCBM*logistics) : 0;
    const baseTotal = co2 + customsFee + blFee;
    const baseShare = totalCBM ? (cbm/totalCBM)*baseTotal : 0;

    const unitCost = (krwBase + duty + logisticsShare + baseShare) / (qty || 1);
    const finalUnit = unitCost / 0.9;

    finalTotal += finalUnit * qty;
  });

  document.getElementById("totalCBM").textContent = totalCBM.toFixed(4);
  document.getElementById("totalBoxes").textContent = totalBoxes;
  document.getElementById("finalTotal").textContent =
      (Math.round(finalTotal/100)*100) + " ì›";

  updateFloatingBar();
}


/* ---------- í”Œë¡œíŒ…ë°” ì—…ë°ì´íŠ¸ ---------- */
function updateFloatingBar() {
  document.getElementById("floatPrice").textContent =
      document.getElementById("finalTotal").textContent;
}


/* ---------- ì¹´ì¹´ì˜¤í†¡ ê²¬ì  ë³´ë‚´ê¸° ---------- */
function sendKakao() {
  let text = "ğŸ“¦ ì¤‘êµ­ ìˆ˜ì… ì˜ˆìƒ ê²¬ì \n\n";

  const rate = getRate();
  text += `í™˜ìœ¨: ${rate}ì›\n\n`;

  document.querySelectorAll(".product-card").forEach((card, idx) => {
    const name = card.querySelector(".p-name").value || "ë¯¸ì…ë ¥";
    const price = card.querySelector(".p-price").value || 0;
    const qty = card.querySelector(".p-qty").value || 0;
    const del = card.querySelector(".p-delivery").value || 0;
    const labor = card.querySelector(".p-labor").value || 0;
    const duty = card.querySelector(".p-duty").value || 0;
    const box = card.querySelector(".p-box").value || "";
    const boxcount = card.querySelector(".p-boxcount").value || 0;
    const cbm = card.querySelector(".p-cbm").textContent || "0.0000";

    text += `ğŸ”¹ ì œí’ˆ ${idx + 1}\n`;
    text += `ì œí’ˆëª…: ${name}\n`;
    text += `ë‹¨ê°€: ${price} RMB\n`;
    text += `ìˆ˜ëŸ‰: ${qty}\n`;
    text += `ì¤‘êµ­íƒë°°ë¹„: ${del} RMB\n`;
    text += `ì¸ê±´ë¹„: ${labor} RMB\n`;
    text += `ê´€ì„¸ìœ¨: ${duty}%\n`;
    text += `ë°•ìŠ¤: ${box} / ${boxcount}ê°œ\n`;
    text += `CBM: ${cbm}\n\n`;
  });

  const totalBoxes = document.getElementById("totalBoxes").textContent;
  const totalCBM = document.getElementById("totalCBM").textContent;
  const finalTotal = document.getElementById("finalTotal").textContent;

  text += "ğŸ“¦ ì „ì²´ ìš”ì•½\n";
  text += `ì „ì²´ ë°•ìŠ¤: ${totalBoxes}ê°œ\n`;
  text += `ì „ì²´ CBM: ${totalCBM}\n`;
  text += `ì´ ì˜ˆìƒê¸ˆì•¡: ${finalTotal}\n\n`;
  text += "â€» ì‹¤ì œ ê¸ˆì•¡ì€ ì„¸ê´€ê²€ì‚¬/ì¤‘ëŸ‰/ë¶€í”¼ì— ë”°ë¼ ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";

  const encoded = encodeURIComponent(text);

  // ëª¨ë°”ì¼ ì¹´ì¹´ì˜¤í†¡ ë§í¬
  const kakaoURL = `kakaolink://send?text=${encoded}`;

  // PC ëŒ€ë¹„ ì²˜ë¦¬
  if (/Android|iPhone|iPad/i.test(navigator.userAgent)) {
    window.location.href = kakaoURL;
  } else {
    alert("ì¹´ì¹´ì˜¤í†¡ì€ ëª¨ë°”ì¼ì—ì„œë§Œ ìë™ ì „ì†¡ë©ë‹ˆë‹¤.\në©”ì‹œì§€ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë©ë‹ˆë‹¤.");
    navigator.clipboard.writeText(text);
  }
}



/* ---------- ì´ë²¤íŠ¸ ---------- */
document.getElementById("addProductBtn").onclick = addProduct;

document.body.addEventListener("input", () => {
  calc();
  saveData();
});

container.addEventListener("click",(e)=>{
  if(e.target.classList.contains("remove-btn")){
    if(document.querySelectorAll(".product-card").length <= 1){
      alert("ìµœì†Œ 1ê°œ ì œí’ˆì´ í•„ìš”í•©ë‹ˆë‹¤.");
      return;
    }
    e.target.closest(".product-card").remove();
    calc();
    saveData();
  }
});


/* ---------- ì‹¤í–‰ ---------- */
loadData();
if(document.querySelectorAll(".product-card").length === 0){
  addProduct();
} else {
  calc();
}

</script>

</body>
</html>
