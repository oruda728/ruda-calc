<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>ë£¨ë‹¤ì”¨ì™€ í•¨ê»˜í•˜ëŠ” ì¤‘êµ­ìˆ˜ì…ëŒ€í–‰ ì˜ˆìƒ ê²¬ì </title>

<style>
/* --------------------- */
/*  ì „ì²´ ê¸°ë³¸ ìŠ¤íƒ€ì¼      */
/* --------------------- */

body {
  font-family: Arial, sans-serif;
  margin: 0 auto;
  padding: 20px;
  color: #333;
  max-width: 1400px;
  background: #f3f4f6;
}

h1 { text-align: center; margin-bottom: 10px; }
.company-info { text-align: center; margin-bottom: 25px; font-size: 16px; color: #555; }

.card {
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(15,23,42,0.08);
  padding: 18px 20px;
  margin-bottom: 20px;
}

.grid-5 {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(150px,1fr));
  gap: 12px 16px;
}

.form-item { display: flex; flex-direction: column; gap: 4px; font-size: 13px; }
label { font-weight: 600; color:#4b5563; }

input,select {
  padding: 6px 8px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-size: 14px;
  text-align: center;
}
input[readonly] { background: #f3f4f8; }

.highlight {
  background:#eef2ff;
  border:1px solid #c7d2fe;
  border-radius:8px;
  padding:7px 12px;
  font-weight:700;
  color:#1d4ed8;
  text-align:right;
}

.add-btn {
  padding:8px 18px;
  border-radius:20px;
  background:#3b82f6;
  color:#fff;
  border:none;
  cursor:pointer;
}

/* ì œí’ˆ ì¹´ë“œ */
.product-card {
  padding:14px 16px;
  border-radius:12px;
  background:#fff;
  border:1px solid #e5e7eb;
  margin-bottom:15px;
}

.product-header {
  display:flex; justify-content:space-between; align-items:center;
  padding-bottom:6px; margin-bottom:8px;
  border-bottom:1px solid #e5e7eb;
}

.remove-product {
  background:#f87171;
  border:none; color:#fff;
  padding:4px 10px;
  border-radius:12px; cursor:pointer;
}

.product-grid { 
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:10px 14px;
}

.box-section { margin-top:10px; padding-top:10px; border-top:1px dashed #d1d5db; }

.custom-dimensions {display:none; gap:10px;}

.breakdown-box {
  background:#f9fafb;
  border:1px solid #e5e7eb;
  border-radius:10px;
  padding:14px 18px;
  margin-top:8px;
  font-size:13px;
  display:none;
  min-width:260px;
  width:fit-content;
}
.breakdown-box div { display:flex; justify-content:space-between; padding:2px 0; }

.toggle-breakdown {
  background:#dbeafe;
  border:none;
  border-radius:5px;
  padding:2px 6px;
  cursor:pointer;
  font-size:11px;
  margin-left:6px;
}

.final-label { font-weight:700; color:#1d4ed8; }
.final-total { font-size:20px; font-weight:800; }

/* PDF ë ˆì´ì•„ì›ƒ ì „ìš© */
#pdfLayout {
  display:none;
  padding:40px;
  font-family:Arial;
  width:100%;
}

#pdf_product_table {
  width:90%;
  margin: 0 auto;
  border-collapse: collapse;
  table-layout: fixed;
  text-align: center;
  font-size:14px;
}
#pdf_product_table th,
#pdf_product_table td {
  padding:10px 5px;
  border-bottom:1px solid #ccc;
}
</style>
</head>
<body>

<h1>ë£¨ë‹¤ì”¨ì™€ í•¨ê»˜í•˜ëŠ” ì¤‘êµ­ìˆ˜ì…ëŒ€í–‰ ì˜ˆìƒ ê²¬ì </h1>

<div class="company-info">
ğŸ“ ê²½ê¸°ë„ í™”ì„±ì‹œ ë‚¨ì–‘ì ì‹ ë‚¨ì•ˆê¸¸ 279-7<br>
â˜ï¸ 010-9239-0071<br>
viva-lavida@naver.com
</div>

<!-- ê¸°ë³¸ ë¹„ìš© ì…ë ¥ -->
<div class="card">
  <h2>ê¸°ë³¸ ë¹„ìš© ì…ë ¥</h2>
  <div class="grid-5">

    <div class="form-item">
      <label>í™˜ìœ¨</label>
      <input type="number" id="exchangeRate" value="200">
    </div>

    <div class="form-item">
      <label>ë¬¼ë¥˜ë¹„ ë‹¨ê°€(ì›/CBM)</label>
      <input type="number" id="logisticsCostManual" value="110000">
    </div>

    <div class="form-item">
      <label>COâ‚‚ ë°œí–‰ë¹„(ë¶€ê°€ì„¸ í¬í•¨)</label>
      <!-- ìˆ«ì + ì› í˜•íƒœ -->
      <div id="co2Cost" class="highlight">0ì›</div>
    </div>

    <div class="form-item">
      <label>ê´€ì„¸ì‚¬ë¹„(ë¶€ê°€ì„¸ í¬í•¨)</label>
      <input type="number" id="customsAgentCostManual" value="33000">
    </div>

    <div class="form-item">
      <label>B/L ì„œë¥˜ë¹„(ë¶€ê°€ì„¸ í¬í•¨)</label>
      <input type="number" id="blCost" value="22000">
    </div>

  </div>
</div>

<!-- ì œí’ˆ ëª©ë¡ ì˜ì—­ -->
<div id="productContainer"></div>


<div style="text-align:center; margin-bottom:20px;">
  <button id="addProduct" class="add-btn">â• ì œí’ˆ ì¶”ê°€</button>
</div>

<!-- ì´í•© ê³„ì‚° -->
<div class="card">
  <h2>ì´í•© ê³„ì‚°</h2>

  <div class="grid-5">

      <div class="form-item">A. í™˜ìœ¨ì‚°ì •ê¸ˆì•¡ <div class="highlight" id="A_total">â‚©0</div></div>
      <div class="form-item">B. ë¬¼ë¥˜ë¹„ ì´ì•¡ <div class="highlight" id="B_total">â‚©0</div></div>
      <div class="form-item">C. ê´€ì„¸ ì´í•© <div class="highlight" id="C_total">â‚©0</div></div>
      <div class="form-item">D. COâ‚‚+ê´€ì„¸ì‚¬+BL <div class="highlight" id="D_basic">â‚©0</div></div>
      <div class="form-item">E. ì „ì²´ í•©ê³„(A+B+C+D) <div class="highlight" id="D_total">â‚©0</div></div>
      <div class="form-item">F. ì´ ë°•ìŠ¤ ìˆ˜ëŸ‰ <div class="highlight" id="F_total">0</div></div>
      <div class="form-item">G. ì „ì²´ CBM í•©ê³„ <div class="highlight" id="G_total">0.0000</div></div>

      <div class="form-item" style="grid-column: 1 / -1;">
        <span class="final-label">H. ì˜ˆìƒ ì²­êµ¬ê¸ˆì•¡ (ë¶€ê°€ì„¸ í¬í•¨)</span>
        <div class="highlight final-total" id="H_total">â‚©0</div>
      </div>

  </div>
</div>
<div style="text-align:center; margin-top:10px;">
  <button id="copyUrlBtn" class="add-btn" style="background:#6366f1;">
    ğŸ”— URL ë³µì‚¬
  </button>
</div>


<!-- PDF ë²„íŠ¼ -->
<div style="text-align:center; margin-top:20px;">
  <button id="pdfBtn" class="add-btn" style="background:#10b981;">
    ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ
  </button>
</div>

<!-- ì œí’ˆ ì¹´ë“œ í…œí”Œë¦¿ -->
<template id="productTemplate">
  <div class="product-card">
    <div class="product-header">
      <strong>ì œí’ˆ ì •ë³´</strong>
      <button type="button" class="remove-product">ì‚­ì œ</button>
    </div>

    <div class="product-grid">

      <div class="form-item">
        <label>ì œí’ˆëª…</label>
        <input type="text" class="product-name">
      </div>

      <div class="form-item">
        <label>ë‹¨ê°€ (RMB)</label>
        <input type="number" class="unit-price">
      </div>

      <div class="form-item">
        <label>ìˆ˜ëŸ‰</label>
        <input type="number" class="quantity">
      </div>

      <div class="form-item">
        <label>ì¤‘êµ­ íƒë°°ë¹„ ì´ì•¡ (RMB)</label>
        <input type="number" class="delivery-total">
      </div>

      <div class="form-item">
        <label>ê°œë‹¹ íƒë°°ë¹„(ìë™ê³„ì‚°)</label>
        <input type="number" class="delivery-per-unit" readonly>
      </div>

      <div class="form-item">
        <label>ë°•ìŠ¤ë¹„</label>
        <input type="number" class="box-cost" readonly>
      </div>

      <div class="form-item">
        <label>ì¸ê±´ë¹„ (RMB)</label>
        <input type="number" class="labor">
      </div>

      <div class="form-item">
        <label>ê´€ì„¸ìœ¨ (%)</label>
        <input type="number" class="duty-rate" value="13">
      </div>

      <div class="form-item">
        <label>ì´ RMB</label>
        <div class="highlight" data-role="total-rmb">Â¥0</div>
      </div>

      <div class="form-item">
        <label>
          í•œêµ­ ë„ì°© ë‹¨ê°€(â‚©)
          <button type="button" class="toggle-breakdown">ë³´ê¸°</button>
        </label>
        <input type="number" class="unit-krw" readonly>
      </div>

      <div class="breakdown-box">
        <div><span>ì œí’ˆì›ê°€:</span><span data-bd="product">0</span></div>
        <div><span>ê´€ì„¸:</span><span data-bd="duty">0</span></div>
        <div><span>ë¬¼ë¥˜ë¹„:</span><span data-bd="logi">0</span></div>
        <div><span>ê¸°ë³¸ë¹„ìš©:</span><span data-bd="base">0</span></div>
        <div><span>ìˆ˜ìˆ˜ë£Œ(10%):</span><span data-bd="fee10">0</span></div>
        <div><span>ê°œë‹¹ë‹¨ê°€(ìˆ˜ìˆ˜ë£Œí¬í•¨):</span><span data-bd="final">0</span></div>
        <div><span>ğŸ“Œ ì œí’ˆ ì´ ê¸ˆì•¡:</span><span data-bd="totalAmount">0</span></div>
      </div>

    </div>

    <div class="box-section">
      <label>ë°•ìŠ¤ì •ë³´</label>

      <div>
        <select class="box-size">
          <option value="">ë°•ìŠ¤ í¬ê¸° ì„ íƒ</option>
          <option value="seller">íŒë§¤ì ì§ì ‘ ì…ë ¥</option>
          <option value="large">ëŒ€ (64Ã—43Ã—48 / 13Â¥)</option>
          <option value="medium">ì¤‘ (53Ã—35Ã—43 / 11Â¥)</option>
          <option value="small">ì†Œ (45Ã—35Ã—37 / 9Â¥)</option>
        </select>
      </div>

      <div class="custom-dimensions">
        <label>ê°€ë¡œ <input type="number" class="dim-l"></label>
        <label>ì„¸ë¡œ <input type="number" class="dim-w"></label>
        <label>ë†’ì´ <input type="number" class="dim-h"></label>
      </div>

      <div class="form-item">
        <label>ë°•ìŠ¤ ìˆ˜ëŸ‰</label>
        <input type="number" class="box-count" placeholder="ë°•ìŠ¤ ìˆ˜ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”">
      </div>

      <div class="form-item">
        <label>ë°•ìŠ¤ CBM</label>
        <div class="highlight" data-role="cbm">0.0000</div>
      </div>

    </div>
  </div>
</template>

<script>
function collectAllData() {
  const data = {};

  // ê¸°ë³¸ ì •ë³´
  data.exchangeRate = document.getElementById("exchangeRate").value;
  data.logisticsCostManual = document.getElementById("logisticsCostManual").value;
  data.customsAgentCostManual = document.getElementById("customsAgentCostManual").value;
  data.blCost = document.getElementById("blCost").value;

  // ì œí’ˆ ëª©ë¡
  data.products = [];

  document.querySelectorAll(".product-card").forEach(card => {
    data.products.push({
      name: card.querySelector(".product-name").value,
      price: card.querySelector(".unit-price").value,
      qty: card.querySelector(".quantity").value,
      deliveryTotal: card.querySelector(".delivery-total").value,
      labor: card.querySelector(".labor").value,
      duty: card.querySelector(".duty-rate").value,
      boxSize: card.querySelector(".box-size").value,
      customL: card.querySelector(".dim-l").value,
      customW: card.querySelector(".dim-w").value,
      customH: card.querySelector(".dim-h").value,
      boxCount: card.querySelector(".box-count").value
    });
  });

  return data;
}


function KRW(v){ return Number(v||0).toLocaleString('ko-KR'); }
function RMB(v){ return Number(v||0).toFixed(2); }

const productContainer=document.getElementById("productContainer");
const template=document.getElementById("productTemplate");

function updateCO2(){
  const rate=parseFloat(document.getElementById("exchangeRate").value)||0;
  const co2Val = rate * 220;
  // ìˆ«ì + 'ì›' í˜•íƒœ
  document.getElementById("co2Cost").textContent = KRW(co2Val) + "ì›";
}

function recalcAll(){

  updateCO2();

  const rate = parseFloat(document.getElementById("exchangeRate").value) || 0;
  const logisticsRate = parseFloat(document.getElementById("logisticsCostManual").value) || 0;

  let totalKRW=0, totalDuty=0, totalCBM=0, totalBoxCount=0;

  const cards=document.querySelectorAll(".product-card");

  /* ---------------- CBM ê³„ì‚° ---------------- */
  cards.forEach(card=>{

    const boxSize=card.querySelector(".box-size").value;
    const boxCount=parseFloat(card.querySelector(".box-count").value)||0;

    let l=0,w=0,h=0;

    if(boxSize==="seller"){
      l=parseFloat(card.querySelector(".dim-l").value)||0;
      w=parseFloat(card.querySelector(".dim-w").value)||0;
      h=parseFloat(card.querySelector(".dim-h").value)||0;
    } else if(boxSize){
      const preset={ large:{l:64,w:43,h:48}, medium:{l:53,w:35,h:43}, small:{l:45,w:35,h:37} }[boxSize];
      l=preset.l; w=preset.w; h=preset.h;
    }

    const cbm=(l*w*h)/1_000_000 * boxCount;
    card.querySelector("[data-role='cbm']").textContent = cbm.toFixed(4);
    totalCBM += cbm;
    totalBoxCount += boxCount;

  });

  // COâ‚‚ ìˆ«ì ì¶”ì¶œ
  const co2Text = document.getElementById("co2Cost").textContent;
  const co2  = parseInt(co2Text.replace(/[^0-9]/g,"")) || 0;
  const customsAgent=parseFloat(document.getElementById("customsAgentCostManual").value)||0;
  const bl=parseFloat(document.getElementById("blCost").value)||0;

  let baseCostTotal = co2 + customsAgent + bl;

  /* ---------------- ì œí’ˆë³„ ê³„ì‚° ---------------- */
  cards.forEach(card=>{

    const unit=parseFloat(card.querySelector(".unit-price").value)||0;
    const qty=parseFloat(card.querySelector(".quantity").value)||0;
    const delTotal=parseFloat(card.querySelector(".delivery-total").value)||0;
    const labor=parseFloat(card.querySelector(".labor").value)||0;
    const dutyRate=parseFloat(card.querySelector(".duty-rate").value)||0;

    const delPer = qty>0 ? delTotal/qty : 0;
    card.querySelector(".delivery-per-unit").value=delPer.toFixed(2);

    const boxSize=card.querySelector(".box-size").value;
    const boxCount=parseFloat(card.querySelector(".box-count").value)||0;

    let boxPrice=0;
    if(boxSize){
      const presetPrice={ large:13, medium:11, small:9 };
      if(boxSize in presetPrice) boxPrice=presetPrice[boxSize];
    }

    const boxCostPerUnit = qty>0 ? (boxPrice*boxCount)/qty : 0;
    card.querySelector(".box-cost").value = boxCostPerUnit.toFixed(2);

    const cbm=parseFloat(card.querySelector("[data-role='cbm']").textContent)||0;

    const rowRMB = (unit + delPer + boxCostPerUnit + labor) * qty;
    const rowKRW = rowRMB * rate;

    totalKRW += rowKRW;

    const duty = rowKRW * (dutyRate/100);
    totalDuty += duty;

    card.querySelector("[data-role='total-rmb']").textContent="Â¥"+RMB(rowRMB);

    const ratio = totalCBM>0 ? cbm / totalCBM : 0;

    const logisticsShare = totalCBM * logisticsRate * ratio;
    const baseShare = baseCostTotal * ratio;

    const sumBeforeMargin = (rowKRW + duty + logisticsShare + baseShare) / (qty || 1);

    const fee10 = sumBeforeMargin * 0.1;
    const finalUnit = sumBeforeMargin + fee10;

    card.querySelector(".unit-krw").value = Math.round(finalUnit);

    /* breakdown í‘œ ì±„ìš°ê¸° */
    card.querySelector("[data-bd='product']").textContent = KRW(Math.round(rowKRW/(qty||1)));
    card.querySelector("[data-bd='duty']").textContent    = KRW(Math.round(duty/(qty||1)));
    card.querySelector("[data-bd='logi']").textContent    = KRW(Math.round(logisticsShare/(qty||1)));
    card.querySelector("[data-bd='base']").textContent    = KRW(Math.round(baseShare/(qty||1)));
    card.querySelector("[data-bd='fee10']").textContent   = KRW(Math.round(fee10));
    card.querySelector("[data-bd='final']").textContent   = KRW(Math.round(finalUnit));

    /* ì œí’ˆ ì´ ê¸ˆì•¡ (ë°˜ì˜¬ë¦¼ 1ë²ˆë§Œ ì ìš©) */
    const totalAmount = Math.round(finalUnit) * qty;
    card.querySelector("[data-bd='totalAmount']").textContent = KRW(totalAmount);



    card.querySelector(".toggle-breakdown").onclick = ()=>{
      const box=card.querySelector(".breakdown-box");
      box.style.display = (box.style.display==="none" || box.style.display==="") ? "block" : "none";
    };
  });

  const logisticsTotal = totalCBM * logisticsRate;

  // A_total (ê·¸ëŒ€ë¡œ)
  document.getElementById("A_total").textContent="â‚©"+KRW(totalKRW);

  // B_total (10ì› ë°˜ì˜¬ë¦¼)
  const roundedB = Math.round(logisticsTotal / 100) * 100;
  document.getElementById("B_total").textContent = "â‚©" + KRW(roundedB);

  // C_total (10ì› ë°˜ì˜¬ë¦¼)
  const roundedC = Math.round(totalDuty / 100) * 100;
  document.getElementById("C_total").textContent = "â‚©" + KRW(roundedC);

  // D_basic (ê·¸ëŒ€ë¡œ)
  document.getElementById("D_basic").textContent="â‚©"+KRW(baseCostTotal);

  // E_total (10ì› ë°˜ì˜¬ë¦¼)
  const totalSum = totalKRW + totalDuty + logisticsTotal + baseCostTotal;
  const roundedE = Math.round(totalSum / 100) * 100;
  document.getElementById("D_total").textContent = "â‚©" + KRW(roundedE);

  // CBM + ë°•ìŠ¤ ìˆ˜ëŸ‰
  document.getElementById("G_total").textContent=totalCBM.toFixed(4);
  document.getElementById("F_total").textContent = totalBoxCount;

  /* H. ì˜ˆìƒ ì²­êµ¬ê¸ˆì•¡ (E Ã· 0.9 ë°©ì‹ + 100ì› ë‹¨ìœ„ ë°˜ì˜¬ë¦¼) */
const eText = document.getElementById("D_total").textContent.replace(/[^0-9]/g, "");
const eValue = parseFloat(eText) || 0;

let hValue = eValue / 0.9;    // ìˆ˜ìˆ˜ë£Œ ì—­ì‚° (10% í¬í•¨)

hValue = Math.round(hValue / 100) * 100;   // 100ì› ë‹¨ìœ„ ë°˜ì˜¬ë¦¼

document.getElementById("H_total").textContent = "â‚©" + KRW(hValue);
}

function addProductCard(){
  const clone = template.content.cloneNode(true);
  productContainer.appendChild(clone);

  const newCard = productContainer.lastElementChild;

  newCard.querySelector(".box-size").addEventListener("change",function(){
    newCard.querySelector(".custom-dimensions").style.display = this.value==="seller" ? "flex" : "none";
    recalcAll();
  });

  recalcAll();
}

document.getElementById("copyUrlBtn").addEventListener("click", () => {

  const data = collectAllData();
  const encoded = btoa(JSON.stringify(data)); // Base64 ì¸ì½”ë”©

  const shareUrl = `${location.origin}${location.pathname}?data=${encoded}`;

  navigator.clipboard.writeText(shareUrl)
    .then(() => alert("ğŸ“ ê³µìœ  URLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ê³ ê°ì—ê²Œ ë³´ë‚´ì£¼ì„¸ìš”."))
    .catch(err => alert("URL ë³µì‚¬ ì‹¤íŒ¨: " + err));
});

document.getElementById("addProduct").onclick=addProductCard;
document.body.addEventListener("input", recalcAll);
document.body.addEventListener("change", recalcAll);

productContainer.addEventListener("click", e=>{
  if(e.target.classList.contains("remove-product")){
    if(document.querySelectorAll(".product-card").length <= 1){
      alert("ìµœì†Œ 1ê°œ ì œí’ˆ í•„ìš”");
      return;
    }
    e.target.closest(".product-card").remove();
    recalcAll();
  }
});

// ìµœì´ˆ í•˜ë‚˜ ì¶”ê°€
addProductCard();
function loadFromUrl() {
  const params = new URLSearchParams(location.search);
  const encoded = params.get("data");

  if (!encoded) return;

  try {
    const data = JSON.parse(atob(encoded));

    // ê¸°ë³¸ ì •ë³´ ë³µì›
    document.getElementById("exchangeRate").value = data.exchangeRate;
    document.getElementById("logisticsCostManual").value = data.logisticsCostManual;
    document.getElementById("customsAgentCostManual").value = data.customsAgentCostManual;
    document.getElementById("blCost").value = data.blCost;

    // ê¸°ì¡´ ì¹´ë“œ ì œê±°
    document.querySelectorAll(".product-card").forEach(p => p.remove());

    // ì œí’ˆ ë³µì›
    data.products.forEach(p => {
      addProductCard();
      const card = document.querySelector(".product-card:last-child");

      card.querySelector(".product-name").value = p.name;
      card.querySelector(".unit-price").value = p.price;
      card.querySelector(".quantity").value = p.qty;
      card.querySelector(".delivery-total").value = p.deliveryTotal;
      card.querySelector(".labor").value = p.labor;
      card.querySelector(".duty-rate").value = p.duty;

      card.querySelector(".box-size").value = p.boxSize;
      if (p.boxSize === "seller") {
        card.querySelector(".custom-dimensions").style.display = "flex";
      }

      card.querySelector(".dim-l").value = p.customL;
      card.querySelector(".dim-w").value = p.customW;
      card.querySelector(".dim-h").value = p.customH;

      card.querySelector(".box-count").value = p.boxCount;
    });

    recalcAll();

  } catch (e) {
    console.error("URL ë³µì› ì˜¤ë¥˜:", e);
  }
}

window.onload = loadFromUrl;

</script>

<!-- ===================== -->
<!--   PDF ì „ìš© ë ˆì´ì•„ì›ƒ   -->
<!-- ===================== -->
<div id="pdfLayout" 
     style="display:none; padding:40px; font-family:Arial; width:100%;">

  <!-- ìƒë‹¨ í—¤ë” -->
  <div style="text-align:center; margin-bottom:25px;">
    <h2 style="margin:0; font-size:26px; color:#1e3a8a; font-weight:800;">
      ë£¨ë‹¤ë¬´ì—­ ì¤‘êµ­ìˆ˜ì…ëŒ€í–‰ ê²¬ì ì„œ
    </h2>
    <div style="margin-top:6px; font-size:14px; color:#666;">
      ğŸ“… ê²¬ì ì¼ì: <span id="pdf_date"></span>
    </div>
  </div>

  <!-- íšŒì‚¬ ì •ë³´ ë°•ìŠ¤ -->
  <div style="
      border:1px solid #d1d5db;
      border-radius:10px;
      padding:15px 25px;
      margin-bottom:25px;
      background:#f8fafc;
    ">
    <h3 style="margin:0 0 10px 0; color:#1e3a8a; font-size:18px;">ğŸ“Œ íšŒì‚¬ ì •ë³´</h3>
    <div style="font-size:14px; line-height:1.6;">
      <strong>ì˜¤ë¥´ë‹¤ / ë£¨ë‹¤ë¬´ì—­</strong><br>
      ê²½ê¸°ë„ í™”ì„±ì‹œ ë‚¨ì–‘ì ì‹ ë‚¨ì•ˆê¸¸ 279-7<br>
      ì´ë©”ì¼: viva-lavida@naver.com<br>
      ì—°ë½ì²˜: 010-9239-0071
    </div>
  </div>

  <!-- ê³ ê° ì •ë³´ ë°•ìŠ¤ -->
  <div style="
      border:1px solid #d1d5db;
      border-radius:10px;
      padding:15px 25px;
      margin-bottom:25px;
      background:#ffffff;
    ">
    <h3 style="margin:0 0 10px 0; color:#1e3a8a; font-size:18px;">ğŸ“Œ ê³ ê° ì •ë³´</h3>
    <div style="font-size:14px; line-height:1.6;">
      ê³ ê°ëª…: <span id="pdf_customer"></span><br>
      ì—°ë½ì²˜: <span id="pdf_customer_phone"></span>
    </div>
  </div>

  <!-- ê¸°ë³¸ ë¹„ìš© -->
  <h3 style="margin-top:10px; color:#1e3a8a; font-size:18px;">ğŸ“Œ ê¸°ë³¸ ë¹„ìš©</h3>
  <table style="width:100%; border-collapse:collapse; font-size:14px; margin-top:8px;">
    <tbody>
      <tr><td>í™˜ìœ¨(ìœ„ì•ˆí™”/ì›)</td><td style="text-align:right;" id="pdf_rate"></td></tr>
      <tr><td>COâ‚‚ ë°œí–‰ë¹„</td><td style="text-align:right;" id="pdf_co2"></td></tr>
      <tr><td>ê´€ì„¸ì‚¬ë¹„</td><td style="text-align:right;" id="pdf_customs"></td></tr>
      <tr><td>B/L ì„œë¥˜ë¹„</td><td style="text-align:right;" id="pdf_bl"></td></tr>
      <tr><td>ë¬¼ë¥˜ë¹„ ë‹¨ê°€(CBM)</td><td style="text-align:right;" id="pdf_logi_unit"></td></tr>
    </tbody>
  </table>

  <hr style="margin:25px 0; border:none; border-top:1px solid #e2e8f0;">

  <!-- ì œí’ˆ ë¦¬ìŠ¤íŠ¸ -->
  <h3 style="color:#1e3a8a; font-size:18px;">ğŸ“Œ ì œí’ˆ ìƒì„¸ ì •ë³´</h3>

  <table id="pdf_product_table"
         style="width:100%; border-collapse:collapse; font-size:14px; margin-top:10px;">
    <thead>
      <tr style="background:#f1f5f9; color:#1e3a8a;">
        <th style="padding:8px; border-bottom:1px solid #cbd5e1;">ì œí’ˆëª…</th>
        <th style="padding:8px; border-bottom:1px solid #cbd5e1;">ìˆ˜ëŸ‰</th>
        <th style="padding:8px; border-bottom:1px solid #cbd5e1;">ê°œë‹¹ë‹¨ê°€(ì›)</th>
        <th style="padding:8px; border-bottom:1px solid #cbd5e1;">ì´ ê¸ˆì•¡</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <hr style="margin:25px 0; border:none; border-top:1px solid #e2e8f0;">

  <!-- ì´í•© -->
  <h3 style="color:#1e3a8a; font-size:18px;">ğŸ“Œ ìµœì¢… ê¸ˆì•¡</h3>
  <table style="width:100%; border-collapse:collapse; font-size:14px; margin-top:8px;">
    <tbody>
      <tr><td>A. í™˜ìœ¨ì‚°ì •ê¸ˆì•¡</td><td style="text-align:right;" id="pdf_A"></td></tr>
      <tr><td>B. ë¬¼ë¥˜ë¹„ ì´ì•¡</td><td style="text-align:right;" id="pdf_B"></td></tr>
      <tr><td>C. ê´€ì„¸ ì´í•©</td><td style="text-align:right;" id="pdf_C"></td></tr>
      <tr><td>D. ê¸°ë³¸ ë¹„ìš©</td><td style="text-align:right;" id="pdf_D"></td></tr>
      <tr><td>E. ì „ì²´ í•©ê³„</td><td style="text-align:right;" id="pdf_E"></td></tr>
    </tbody>
  </table>

  <!-- ìµœì¢… ê¸ˆì•¡ ê°•ì¡° ë°•ìŠ¤ -->
  <div style="
      margin-top:25px;
      padding:18px;
      border-radius:12px;
      background:#eef2ff;
      color:#1e3a8a;
      text-align:right;
      font-size:20px;
      font-weight:800;
    ">
    ìµœì¢… ì²­êµ¬ê¸ˆì•¡(ë¶€ê°€ì„¸ í¬í•¨): <span id="pdf_H"></span>
  </div>

  <hr style="margin:25px 0; border:none; border-top:1px solid #e2e8f0;">

  <!-- ì•ˆë‚´ ë¬¸êµ¬ -->
  <p style="font-size:12px; color:#64748b; line-height:1.6;">
    â€» ë³¸ ê²¬ì ì€ ë„¤ì´ë²„ í™˜ìœ¨(ë³´ë‚´ëŠ” ê¸ˆì•¡ ê¸°ì¤€) ë°˜ì˜¬ë¦¼ ì ìš© ê¸ˆì•¡ì…ë‹ˆë‹¤.<br>
    â€» ì¤‘êµ­ ë‚´ ë¬¼ë¥˜ ìƒí™© ë° í™˜ìœ¨ì— ë”°ë¼ ê¸ˆì•¡ì´ ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
    â€» ëª¨ë“  ê¸ˆì•¡ì€ ë¶€ê°€ì„¸í¬í•¨ê¸ˆì•¡ì…ë‹ˆë‹¤.
  </p>

</div>



<!-- PDF ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
document.getElementById("pdfBtn").addEventListener("click", async () => {

    // ê³„ì‚° ìµœì‹ í™”
    recalcAll();

    const customer = prompt("ê³ ê°ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”", "");
    const phone = prompt("ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”", "");

    // ë‚ ì§œ
    document.getElementById("pdf_date").textContent = new Date().toLocaleDateString();
    document.getElementById("pdf_customer").textContent = customer || "-";
    document.getElementById("pdf_customer_phone").textContent = phone || "-";

    // CO2 ìˆ«ì ë‹¤ì‹œ ì¶”ì¶œ
    const co2Text = document.getElementById("co2Cost").textContent;
    const co2Val  = parseInt(co2Text.replace(/[^0-9]/g,"")) || 0;

    // ê¸°ë³¸ ë¹„ìš©
    document.getElementById("pdf_rate").textContent      = KRW(document.getElementById("exchangeRate").value) + "ì›(1ìœ„ì•ˆ)";
    document.getElementById("pdf_co2").textContent       = KRW(co2Val) + "ì›";
    document.getElementById("pdf_customs").textContent   = KRW(document.getElementById("customsAgentCostManual").value) + "ì›";
    document.getElementById("pdf_bl").textContent        = KRW(document.getElementById("blCost").value) + "ì›";
    document.getElementById("pdf_logi_unit").textContent = KRW(document.getElementById("logisticsCostManual").value) + "ì›/CBM";

    // ì´í•© (ì´ë¯¸ 'â‚©' í¬í•¨ëœ í…ìŠ¤íŠ¸ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
    document.getElementById("pdf_A").textContent = document.getElementById("A_total").textContent;
    document.getElementById("pdf_B").textContent = document.getElementById("B_total").textContent;
    document.getElementById("pdf_C").textContent = document.getElementById("C_total").textContent;
    document.getElementById("pdf_D").textContent = document.getElementById("D_basic").textContent;
    document.getElementById("pdf_E").textContent = document.getElementById("D_total").textContent;
    // PDFìš© H_total ê³„ì‚° (E Ã· 0.9 ë°©ì‹)
const ePdfText = document.getElementById("pdf_E").textContent.replace(/[^0-9]/g, "");
const ePdfValue = parseFloat(ePdfText) || 0;

// ìˆ˜ìˆ˜ë£Œ ì—­ì‚° ê³„ì‚°
let hPdfValue = ePdfValue / 0.9;

// 100ì› ë‹¨ìœ„ ë°˜ì˜¬ë¦¼
hPdfValue = Math.round(hPdfValue / 100) * 100;

document.getElementById("pdf_H").textContent = "â‚©" + KRW(hPdfValue);


    // ì œí’ˆ í‘œ
    const tbody = document.querySelector("#pdf_product_table tbody");
    tbody.innerHTML = "";

    document.querySelectorAll(".product-card").forEach(card => {
        const name  = card.querySelector(".product-name").value || "-";
        const qty   = card.querySelector(".quantity").value || "0";
        const unit  = parseFloat(card.querySelector(".unit-krw").value) || 0;
        const total = card.querySelector("[data-bd='totalAmount']").textContent || "0";

        const row = `
          <tr>
            <td>${name}</td>
            <td>${qty}</td>
            <td style="text-align:right;">${KRW(unit)}ì›</td>
            <td style="text-align:right;">${total}ì›</td>
          </tr>
        `;
        tbody.insertAdjacentHTML("beforeend", row);
    });

    // PDF ìƒì„±
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF("p", "mm", "a4");

    const layout = document.getElementById("pdfLayout");
    layout.style.display = "block";

    const canvas = await html2canvas(layout, { scale: 2 });
    const imgData = canvas.toDataURL("image/png");

    const imgWidth = 210;
    const pageHeight = 297;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;

    let heightLeft = imgHeight;
    let position = 0;

    pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
    heightLeft -= pageHeight;

    while (heightLeft > 0) {
        position = heightLeft - imgHeight;
        pdf.addPage();
        pdf.addImage(imgData, "PNG", 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
    }

    pdf.save("ë£¨ë‹¤ë¬´ì—­_ê²¬ì ì„œ.pdf");
    layout.style.display = "none";
});
</script>

</body>
</html>
